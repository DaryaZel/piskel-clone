!function(t){var e={};function o(i){if(e[i])return e[i].exports;var l=e[i]={i:i,l:!1,exports:{}};return t[i].call(l.exports,l,l.exports,o),l.l=!0,l.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)o.d(i,l,function(e){return t[e]}.bind(null,l));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="./..",o(o.s=0)}([function(t,e,o){t.exports=o(3)},function(t,e,o){},function(t,e,o){},function(t,e,o){"use strict";function i(){localStorage.setItem("link",0),localStorage.setItem("canvas",canvas.toDataURL())}function l(t){return{x:t.offsetX,y:t.offsetY}}function s(t,e){return{x:10*Math.ceil(t/10),y:10*Math.ceil(e/10)}}function n(t,e,o,i){o.fillStyle=`${i}`,o.fillRect(t,e,10,10)}o.r(e);const a=new class{get primaryColor(){return document.querySelector("#сurrent").value}get secondaryColor(){return document.querySelector("#previous").value}},c=new class{getPixelColor(t,e,o){const i=4*(o*t.width+e),l={};return l.r=t.data[i],l.g=t.data[i+1],l.b=t.data[i+2],l.a=t.data[i+3],l}convertHexToRgba(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}};let r=document.getElementById("canvas"),u=document.getElementById("paint_bucket"),d=document.getElementById("choose_color"),h=document.getElementById("pencil"),m=document.getElementById("pencil2"),f=document.getElementById("pencil3"),g=document.getElementById("line"),v=document.getElementById("eraser"),y=document.getElementById("clear"),p=document.getElementById("сurrent_color"),b=(document.querySelector(".section-main-sidebar-tools-list"),document.querySelectorAll(".section-main-sidebar-tools-list__item")),_=document.querySelectorAll(".section-main-switch__button"),x=document.getElementById("btn_to-project"),w=r.getContext("2d");(new Image).src="assets/images/image.png";let I=new class{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=r.getContext("2d"),this.img=new Image,this.tool="pencil",this.previous_color=document.getElementById("previous_color"),this.сurrent_color=document.getElementById("сurrent_color"),this.clear=document.getElementById("clear")}activeTool(t){this.tool=t}activeButton(t){switch(this.button=t,this.button){case"btn_4x4":this.canvasChange(1024);break;case"btn_32x32":this.canvasChange(256);break;case"btn_128x128":this.canvasChange(128)}}activeColor(t){this.color=t}init(){this.canvas.onmousedown=t=>this.mouseDown(t)}clearEvent(){this.clear.addEventListener("click",()=>{this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,512,512),i()})}colorChangeEvent(){let t=this.сurrent_color.firstElementChild.value;this.сurrent_color.addEventListener("change",e=>{this.previous_color.firstElementChild.value=t,t=p.firstElementChild.value})}mouseDown(t){switch(this.savedData=this.ctx.getImageData(0,0,this.canvas.clientWidth,this.canvas.clientHeight),this.canvas.onmousemove=t=>this.mouseMove(t),document.onmouseup=t=>this.mouseUp(t),this.startPoint=l(t),this.tool){case"choose_color":this.chooseColor();break;case"paint_bucket":this.bucketTool(t)}}mouseMove(t){switch(this.currentPoint=l(t),this.tool){case"pencil":case"pencil2":case"pencil3":case"line":this.draw(this.сurrent_color.firstElementChild.value);break;case"eraser":this.draw("#ffffff")}console.log(t.offsetX,t.offsetY)}mouseUp(t){this.canvas.onmousemove=null,document.onmouseup=null,this.oldX=this.oldY=null,this.endPoint=l(t)}draw(t){if("line"===this.tool){this.ctx.putImageData(this.savedData,0,0);const e=s(this.startPoint.x-10,this.startPoint.y-10),o=s(this.currentPoint.x-10,this.currentPoint.y-10);!function(t,e,o,i,l,s){let a,c,r,u,d,h,m,f,g,v,y;if(r=o-t,u=i-e,d=Math.abs(r),h=Math.abs(u),m=2*h-d,f=2*d-h,h<=d)for(r>=0?(a=t,c=e,g=o):(a=o,c=i,g=t),n(a,c,l,s),y=0;a<g;y++)a+=10,m<0?m+=2*h:(r<0&&u<0||r>0&&u>0?c+=10:c-=10,m+=2*(h-d)),n(a,c,l,s);else for(u>=0?(a=t,c=e,v=i):(a=o,c=i,v=e),n(a,c,l,s),y=0;c<v;y++)c+=10,f<=0?f+=2*d:(r<0&&u<0||r>0&&u>0?a+=10:a-=10,f+=2*(d-h)),n(a,c,l,s)}(e.x,e.y,o.x,o.y,this.ctx,t),i()}else if("pencil"===this.tool||"pencil2"===this.tool||"pencil3"===this.tool||"eraser"===this.tool){if("pencil"===this.tool?this.size=12:"pencil2"===this.tool?this.size=19:"pencil3"!==this.tool&&"eraser"!==this.tool||(this.size=36),this.currentPoint,this.x=this.currentPoint.x,this.y=this.currentPoint.y,null!==this.oldX&&null!=this.oldX){(function(t,e){let{x:o,y:i}=t,l=Math.abs(o-e.x),s=Math.abs(i-e.y),n=o<e.x?1:-1,a=i<e.y?1:-1,c=l-s,r=[];for(;r.push({x:o,y:i}),o!==e.x||i!==e.y;){const t=2*c;t>-s&&(c-=s,o+=n),t<l&&(c+=l,i+=a)}return console.log(r),r})(this.currentPoint,{x:this.oldX,y:this.oldY}).forEach(({x:t,y:e})=>{w.fillRect(Math.floor(t/this.size)*this.size,Math.floor(e/this.size)*this.size,this.size,this.size)})}this.oldX=this.x,this.oldY=this.y}w.lineWidth=3,this.ctx.fillStyle=""+t,i()}chooseColor(){let t,e=this,o=localStorage.getItem("canvas");this.img.src=o,this.img.onload=function(){var o,i,l;e.ctx.drawImage(this,0,0),t=e.ctx.getImageData(e.startPoint.x,e.startPoint.y,1,1).data,e.previous_color.firstElementChild.value=e.сurrent_color.firstElementChild.value,e.сurrent_color.firstElementChild.value=(o=t[0],i=t[1],l=t[2],"#"+((1<<24)+(o<<16)+(i<<8)+l).toString(16).slice(1))}}bucketTool(t){const e=this.canvas,o=this.ctx;let l=o.getImageData(0,0,e.width,e.height),s=null;2===t.button?(s=c.convertHexToRgba(a.secondaryColor),o.fillStyle=a.secondaryColor):(o.fillStyle=a.primaryColor,s=c.convertHexToRgba(a.primaryColor)),function(t){l=o.getImageData(0,0,e.width,e.height);let n=t.offsetX,a=t.offsetY;n=Math.floor(n),a=Math.floor(a);const r=c.getPixelColor(l,n,a),u=[[n,a]],d=o.getImageData(0,0,e.width,e.height),h=r.r,m=r.g,f=r.b;if(h!=s.r||m!=s.g||f!=s.b){for(;u.length;){let t=[],o=null,i=null,l=null,s=null,n=null;for(t=u.pop(),[s,n]=[t[0],t[1]],o=4*(n*e.width+s);n>=0&&g(o);)n-=1,o-=4*e.width;for(o+=4*e.width,i=!1,l=!1;n<e.height-1&&g(o);)n+=1,v(o),s>0&&(g(o-4)?i||(u.push([s-1,n]),i=!0):i&&(i=!1)),s<e.width-1&&(g(o+4)?l||(u.push([s+1,n]),l=!0):l&&(l=!1)),o+=4*e.width}o.putImageData(d,0,0),i()}function g(t){const e=d.data[t],o=d.data[t+1],i=d.data[t+2];return e==h&&o==m&&i==f}function v(t){d.data[t]=s.r,d.data[t+1]=s.g,d.data[t+2]=s.b,d.data[t+3]=255}}(t)}canvasChange(t){let e=localStorage.getItem("canvas");w.fillStyle="#ffffff",w.fillRect(0,0,512,512);let o=new Image;o.src=e,o.onload=function(){w.drawImage(o,256-t/2,256-t/2,t,t),i()}}};I.init(),I.clearEvent(),I.colorChangeEvent(),(new class{constructor(){this.tools=document.querySelector(".section-main-sidebar-tools-list")}showmessage(){this.tools.addEventListener("mouseover",t=>{let e=t.target,o=e.getAttribute("data-tooltip");if(o){let t=document.createElement("div");t.className="tooltip",t.innerHTML=o||tooltipchild,document.body.appendChild(t);let i=e.getBoundingClientRect(),l=i.left+(e.offsetWidth-t.offsetWidth)/2;l<0&&(l=0);let s=i.top-t.offsetHeight-5;s<0&&(s=i.top+e.offsetHeight+5),t.style.left=l+"px",t.style.top=s+"px",this.showingTooltip=t}}),this.tools.addEventListener("mouseout",t=>{this.showingTooltip&&(document.body.removeChild(this.showingTooltip),this.showingTooltip=null)})}}).showmessage(),function(){let t=localStorage.getItem("canvas"),e=localStorage.getItem("link");if(t&&"0"===e){let e=new Image;e.src=t,e.onload=function(){w.drawImage(e,0,0)}}else 0!==e?function(t){w.fillStyle="#ffffff",w.fillRect(0,0,512,512);let e=new Image;e.src=t,e.onload=function(){w.drawImage(e,256-e.width/2,256-e.height/2)}}(e):(w.fillStyle="#ffffff",w.fillRect(0,0,512,512))}(),_.forEach(t=>{t.addEventListener("click",e=>{let o=t.id;I.activeButton(o),document.querySelector(".section-main-switch__button.active").classList.remove("active"),e.target.classList.toggle("active")})}),b.forEach(t=>{t.addEventListener("click",e=>{document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active");let o=t.firstElementChild.id;I.activeTool(o),"section-main-sidebar-tools-list__item"===e.target.className?e.target.firstChild.classList.toggle("active"):e.target.classList.toggle("active")})}),document.addEventListener("keydown",t=>{t.altKey&&66===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),u.classList.toggle("active"),I.activeTool("paint_bucket")):t.altKey&&80===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),h.classList.toggle("active"),I.activeTool("pencil")):t.altKey&&67===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),d.classList.toggle("active"),I.activeTool("choose_color")):t.altKey&&79===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),m.classList.toggle("active"),I.activeTool("pencil2")):t.altKey&&73===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),f.classList.toggle("active"),I.activeTool("pencil3")):t.altKey&&76===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),g.classList.toggle("active"),I.activeTool("line")):t.altKey&&69===t.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),v.classList.toggle("active"),I.activeTool("eraser")):t.altKey&&88===t.keyCode&&(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),y.children[0].classList.toggle("active"),w.fillStyle="#ffffff",w.fillRect(0,0,512,512),i())}),x.addEventListener("click",t=>{document.getElementById("wrapper-loading-page").style.display="none",document.getElementById("wrapper-main-page").style.display="block"}),o(1),o(2)}]);