!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="./..",o(o.s=0)}([function(t,e,o){t.exports=o(2)},function(t,e,o){},function(t,e,o){"use strict";function n(){localStorage.setItem("link",0),localStorage.setItem("canvas",canvas.toDataURL())}function i(t){return{x:t.offsetX,y:t.offsetY}}function l(t,e){return{x:10*Math.ceil(t/10),y:10*Math.ceil(e/10)}}function s(t,e,o,n){o.fillStyle=`${n}`,o.fillRect(t,e,10,10)}o.r(e);const a=new class{get primaryColor(){return document.querySelector("#сurrent").value}get secondaryColor(){return document.querySelector("#previous").value}},c=new class{getPixelColor(t,e,o){const n=4*(o*t.width+e),i={};return i.r=t.data[n],i.g=t.data[n+1],i.b=t.data[n+2],i.a=t.data[n+3],i}convertHexToRgba(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}};document.getElementById("btn_4x4"),document.getElementById("btn_32x32"),document.getElementById("btn_img");let r=document.getElementById("canvas"),u=(document.getElementById("blackAndWhite"),document.getElementById("paint_bucket")),d=document.getElementById("choose_color"),h=(document.getElementById("previous_color"),document.getElementById("pencil")),f=(document.getElementById("pencil2"),document.getElementById("pencil3"),document.getElementById("сurrent_color")),m=(document.querySelector(".section-main-sidebar-tools-list"),document.querySelectorAll(".section-main-sidebar-tools-list__item")),g=document.querySelectorAll(".section-main-switch__button"),v=document.getElementById("btn_to-project"),y=r.getContext("2d");(new Image).src="assets/images/image.png";let p=new class{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=r.getContext("2d"),this.img=new Image,this.tool="pencil",this.previous_color=document.getElementById("previous_color"),this.сurrent_color=document.getElementById("сurrent_color"),this.clear=document.getElementById("clear")}activeTool(t){this.tool=t}activeButton(t){switch(this.button=t,this.button){case"btn_4x4":this.canvasChange(4096);break;case"btn_32x32":this.canvasChange(64)}}activeColor(t){this.color=t}init(){this.canvas.onmousedown=t=>this.mouseDown(t)}clearEvent(){this.clear.addEventListener("click",()=>{this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,512,512),n()})}colorChangeEvent(){let t=this.сurrent_color.firstElementChild.value;this.сurrent_color.addEventListener("change",e=>{this.previous_color.firstElementChild.value=t,t=f.firstElementChild.value})}mouseDown(t){switch(this.savedData=this.ctx.getImageData(0,0,this.canvas.clientWidth,this.canvas.clientHeight),this.canvas.onmousemove=t=>this.mouseMove(t),document.onmouseup=t=>this.mouseUp(t),this.startPoint=i(t),this.tool){case"choose_color":this.chooseColor();break;case"paint_bucket":this.bucketTool(t)}}mouseMove(t){switch(this.currentPoint=i(t),this.tool){case"pencil":case"pencil2":case"pencil3":case"line":this.draw(this.сurrent_color.firstElementChild.value);break;case"eraser":this.draw("#ffffff")}console.log(t.offsetX,t.offsetY)}mouseUp(t){this.canvas.onmousemove=null,document.onmouseup=null,this.oldX=this.oldY=null,this.endPoint=i(t)}draw(t){if("line"===this.tool){this.ctx.putImageData(this.savedData,0,0);const e=l(this.startPoint.x-10,this.startPoint.y-10),o=l(this.currentPoint.x-10,this.currentPoint.y-10);!function(t,e,o,n,i,l){let a,c,r,u,d,h,f,m,g,v,y;if(r=o-t,u=n-e,d=Math.abs(r),h=Math.abs(u),f=2*h-d,m=2*d-h,h<=d)for(r>=0?(a=t,c=e,g=o):(a=o,c=n,g=t),s(a,c,i,l),y=0;a<g;y++)a+=10,f<0?f+=2*h:(r<0&&u<0||r>0&&u>0?c+=10:c-=10,f+=2*(h-d)),s(a,c,i,l);else for(u>=0?(a=t,c=e,v=n):(a=o,c=n,v=e),s(a,c,i,l),y=0;c<v;y++)c+=10,m<=0?m+=2*d:(r<0&&u<0||r>0&&u>0?a+=10:a-=10,m+=2*(d-h)),s(a,c,i,l)}(e.x,e.y,o.x,o.y,this.ctx,t),n()}else if("pencil"===this.tool||"pencil2"===this.tool||"pencil3"===this.tool||"eraser"===this.tool){if("pencil"===this.tool?this.size=12:"pencil2"===this.tool?this.size=19:"pencil3"!==this.tool&&"eraser"!==this.tool||(this.size=36),this.currentPoint,this.x=this.currentPoint.x,this.y=this.currentPoint.y,null!==this.oldX&&null!=this.oldX){(function(t,e){let{x:o,y:n}=t,i=Math.abs(o-e.x),l=Math.abs(n-e.y),s=o<e.x?1:-1,a=n<e.y?1:-1,c=i-l,r=[];for(;r.push({x:o,y:n}),o!==e.x||n!==e.y;){const t=2*c;t>-l&&(c-=l,o+=s),t<i&&(c+=i,n+=a)}return console.log(r),r})(this.currentPoint,{x:this.oldX,y:this.oldY}).forEach(({x:t,y:e})=>{y.fillRect(Math.floor(t/this.size)*this.size,Math.floor(e/this.size)*this.size,this.size,this.size)})}this.oldX=this.x,this.oldY=this.y}y.lineWidth=3,this.ctx.fillStyle=""+t,n()}chooseColor(){let t,e=this,o=localStorage.getItem("canvas");this.img.src=o,this.img.onload=function(){var o,n,i;e.ctx.drawImage(this,0,0),t=e.ctx.getImageData(e.startPoint.x,e.startPoint.y,1,1).data,e.previous_color.firstElementChild.value=e.сurrent_color.firstElementChild.value,e.сurrent_color.firstElementChild.value=(o=t[0],n=t[1],i=t[2],"#"+((1<<24)+(o<<16)+(n<<8)+i).toString(16).slice(1))}}bucketTool(t){const e=this.canvas,o=this.ctx;let i=o.getImageData(0,0,e.width,e.height),l=null;2===t.button?(l=c.convertHexToRgba(a.secondaryColor),o.fillStyle=a.secondaryColor):(o.fillStyle=a.primaryColor,l=c.convertHexToRgba(a.primaryColor)),function(t){i=o.getImageData(0,0,e.width,e.height);let s=t.offsetX,a=t.offsetY;s=Math.floor(s),a=Math.floor(a);const r=c.getPixelColor(i,s,a),u=[[s,a]],d=o.getImageData(0,0,e.width,e.height),h=r.r,f=r.g,m=r.b;if(h!=l.r||f!=l.g||m!=l.b){for(;u.length;){let t=[],o=null,n=null,i=null,l=null,s=null;for(t=u.pop(),[l,s]=[t[0],t[1]],o=4*(s*e.width+l);s>=0&&g(o);)s-=1,o-=4*e.width;for(o+=4*e.width,n=!1,i=!1;s<e.height-1&&g(o);)s+=1,v(o),l>0&&(g(o-4)?n||(u.push([l-1,s]),n=!0):n&&(n=!1)),l<e.width-1&&(g(o+4)?i||(u.push([l+1,s]),i=!0):i&&(i=!1)),o+=4*e.width}o.putImageData(d,0,0),n()}function g(t){const e=d.data[t],o=d.data[t+1],n=d.data[t+2];return e==h&&o==f&&n==m}function v(t){d.data[t]=l.r,d.data[t+1]=l.g,d.data[t+2]=l.b,d.data[t+3]=255}}(t)}canvasChange(t){let e=localStorage.getItem("canvas");y.fillStyle="#ffffff",y.fillRect(0,0,512,512);let o=new Image;o.src=e,o.onload=function(){y.drawImage(o,256-t/2,256-t/2,t,t),n()}}};p.init(),p.clearEvent(),p.colorChangeEvent(),function(){let t=localStorage.getItem("canvas"),e=localStorage.getItem("link");if(t&&"0"===e){let e=new Image;e.src=t,e.onload=function(){y.drawImage(e,0,0)}}else 0!==e?function(t){y.fillStyle="#ffffff",y.fillRect(0,0,512,512);let e=new Image;e.src=t,e.onload=function(){y.drawImage(e,256-e.width/2,256-e.height/2)}}(e):(y.fillStyle="#ffffff",y.fillRect(0,0,512,512))}(),g.forEach(t=>{t.addEventListener("click",e=>{let o=t.id;p.activeButton(o),document.querySelector(".section-main-switch__button.active").classList.remove("active"),e.target.classList.toggle("active")})}),m.forEach(t=>{t.addEventListener("click",e=>{document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active");let o=t.firstElementChild.id;p.activeTool(o),"section-main-sidebar-tools-list__item"===e.target.className?e.target.firstChild.classList.toggle("active"):e.target.classList.toggle("active")})}),document.addEventListener("keydown",t=>{t.altKey&&66===t.keyCode?(cleanActive(m),u.classList.toggle("active")):t.altKey&&80===t.keyCode?(cleanActive(m),h.classList.toggle("active")):t.altKey&&67===t.keyCode&&(cleanActive(m),d.classList.toggle("active"))}),v.addEventListener("click",t=>{document.getElementById("wrapper-loading-page").style.display="none",document.getElementById("wrapper-main-page").style.display="block"}),o(1)}]);