!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./..",i(i.s=0)}([function(e,t,i){e.exports=i(3)},function(e,t,i){},function(e,t,i){},function(e,t,i){"use strict";function n(e,t){t?localStorage.setItem(`${e}`,t):localStorage.setItem(`${e}`,canvas.toDataURL()),localStorage.setItem("link",0),localStorage.setItem("canvas",canvas.toDataURL())}function o(e){return{x:e.offsetX,y:e.offsetY}}function l(e,t){return{x:10*Math.ceil(e/10),y:10*Math.ceil(t/10)}}function a(e,t,i,n){i.fillStyle=`${n}`,i.fillRect(e,t,10,10)}i.r(t);const s=new class{get primaryColor(){return document.querySelector("#сurrent").value}get secondaryColor(){return document.querySelector("#previous").value}},c=new class{getPixelColor(e,t,i){const n=4*(i*e.width+t),o={};return o.r=e.data[n],o.g=e.data[n+1],o.b=e.data[n+2],o.a=e.data[n+3],o}convertHexToRgba(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}};let r=document.getElementById("canvas"),d=document.getElementById("paint_bucket"),m=document.getElementById("choose_color"),u=document.getElementById("pencil"),h=document.getElementById("pencil2"),g=document.getElementById("pencil3"),f=document.getElementById("line"),v=document.getElementById("eraser"),p=document.getElementById("clear"),y=document.getElementById("сurrent_color"),b=document.querySelectorAll(".section-main-sidebar-tools-list__item"),E=document.querySelectorAll(".section-main-switch__button"),x=document.getElementById("btn_to-project"),_=document.getElementById("add"),I=document.getElementById("mainFrame"),S=r.getContext("2d");(new Image).src="assets/images/image.png";let C=new class{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=r.getContext("2d"),this.img=new Image,this.tool="pencil",this.previous_color=document.getElementById("previous_color"),this.сurrent_color=document.getElementById("сurrent_color"),this.clear=document.getElementById("clear")}activeTool(e){this.tool=e}activeButton(e){switch(this.button=e,this.button){case"btn_4x4":this.canvasChange(1024);break;case"btn_32x32":this.canvasChange(256);break;case"btn_128x128":this.canvasChange(128)}}activeColor(e){this.color=e}init(){this.canvas.onmousedown=e=>this.mouseDown(e)}clearEvent(){this.clear.addEventListener("click",()=>{this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,512,512),w()})}colorChangeEvent(){let e=this.сurrent_color.firstElementChild.value;this.сurrent_color.addEventListener("change",t=>{this.previous_color.firstElementChild.value=e,e=y.firstElementChild.value})}mouseDown(e){switch(this.savedData=this.ctx.getImageData(0,0,this.canvas.clientWidth,this.canvas.clientHeight),this.canvas.onmousemove=e=>this.mouseMove(e),document.onmouseup=e=>this.mouseUp(e),this.startPoint=o(e),this.tool){case"choose_color":this.chooseColor();break;case"paint_bucket":this.bucketTool(e)}}mouseMove(e){switch(this.currentPoint=o(e),this.tool){case"pencil":case"pencil2":case"pencil3":case"line":this.draw(this.сurrent_color.firstElementChild.value);break;case"eraser":this.draw("#ffffff")}console.log(e.offsetX,e.offsetY)}mouseUp(e){this.canvas.onmousemove=null,document.onmouseup=null,this.oldX=this.oldY=null,this.endPoint=o(e)}draw(e){if("line"===this.tool){this.ctx.putImageData(this.savedData,0,0);const t=l(this.startPoint.x-10,this.startPoint.y-10),i=l(this.currentPoint.x-10,this.currentPoint.y-10);!function(e,t,i,n,o,l){let s,c,r,d,m,u,h,g,f,v,p;if(r=i-e,d=n-t,m=Math.abs(r),u=Math.abs(d),h=2*u-m,g=2*m-u,u<=m)for(r>=0?(s=e,c=t,f=i):(s=i,c=n,f=e),a(s,c,o,l),p=0;s<f;p++)s+=10,h<0?h+=2*u:(r<0&&d<0||r>0&&d>0?c+=10:c-=10,h+=2*(u-m)),a(s,c,o,l);else for(d>=0?(s=e,c=t,v=n):(s=i,c=n,v=t),a(s,c,o,l),p=0;c<v;p++)c+=10,g<=0?g+=2*m:(r<0&&d<0||r>0&&d>0?s+=10:s-=10,g+=2*(m-u)),a(s,c,o,l)}(t.x,t.y,i.x,i.y,this.ctx,e),w()}else if("pencil"===this.tool||"pencil2"===this.tool||"pencil3"===this.tool||"eraser"===this.tool){if("pencil"===this.tool?this.size=12:"pencil2"===this.tool?this.size=19:"pencil3"!==this.tool&&"eraser"!==this.tool||(this.size=36),this.currentPoint,this.x=this.currentPoint.x,this.y=this.currentPoint.y,null!==this.oldX&&null!=this.oldX){(function(e,t){let{x:i,y:n}=e,o=Math.abs(i-t.x),l=Math.abs(n-t.y),a=i<t.x?1:-1,s=n<t.y?1:-1,c=o-l,r=[];for(;r.push({x:i,y:n}),i!==t.x||n!==t.y;){const e=2*c;e>-l&&(c-=l,i+=a),e<o&&(c+=o,n+=s)}return console.log(r),r})(this.currentPoint,{x:this.oldX,y:this.oldY}).forEach(({x:e,y:t})=>{S.fillRect(Math.floor(e/this.size)*this.size,Math.floor(t/this.size)*this.size,this.size,this.size)})}this.oldX=this.x,this.oldY=this.y}S.lineWidth=3,this.ctx.fillStyle=""+e,w()}chooseColor(){let e,t=this,i=localStorage.getItem("canvas");this.img.src=i,this.img.onload=function(){var i,n,o;t.ctx.drawImage(this,0,0),e=t.ctx.getImageData(t.startPoint.x,t.startPoint.y,1,1).data,t.previous_color.firstElementChild.value=t.сurrent_color.firstElementChild.value,t.сurrent_color.firstElementChild.value=(i=e[0],n=e[1],o=e[2],"#"+((1<<24)+(i<<16)+(n<<8)+o).toString(16).slice(1))}}bucketTool(e){const t=this.canvas,i=this.ctx;let n=i.getImageData(0,0,t.width,t.height),o=null;2===e.button?(o=c.convertHexToRgba(s.secondaryColor),i.fillStyle=s.secondaryColor):(i.fillStyle=s.primaryColor,o=c.convertHexToRgba(s.primaryColor)),function(e){n=i.getImageData(0,0,t.width,t.height);let l=e.offsetX,a=e.offsetY;l=Math.floor(l),a=Math.floor(a);const s=c.getPixelColor(n,l,a),r=[[l,a]],d=i.getImageData(0,0,t.width,t.height),m=s.r,u=s.g,h=s.b;if(m!=o.r||u!=o.g||h!=o.b){for(;r.length;){let e=[],i=null,n=null,o=null,l=null,a=null;for(e=r.pop(),[l,a]=[e[0],e[1]],i=4*(a*t.width+l);a>=0&&g(i);)a-=1,i-=4*t.width;for(i+=4*t.width,n=!1,o=!1;a<t.height-1&&g(i);)a+=1,f(i),l>0&&(g(i-4)?n||(r.push([l-1,a]),n=!0):n&&(n=!1)),l<t.width-1&&(g(i+4)?o||(r.push([l+1,a]),o=!0):o&&(o=!1)),i+=4*t.width}i.putImageData(d,0,0),w()}function g(e){const t=d.data[e],i=d.data[e+1],n=d.data[e+2];return t==m&&i==u&&n==h}function f(e){d.data[e]=o.r,d.data[e+1]=o.g,d.data[e+2]=o.b,d.data[e+3]=255}}(e)}canvasChange(e){let t=localStorage.getItem("canvas");S.fillStyle="#ffffff",S.fillRect(0,0,512,512);let i=new Image;i.src=t,i.onload=function(){S.drawImage(i,256-e/2,256-e/2,e,e),n()}}};function w(){let e=document.querySelector(".section-main-frame-canvas.act").id,t=document.getElementById(`${e}`).getContext("2d");n(e);let i=localStorage.getItem(`${e}`),o=new Image;o.src=i,o.onload=function(){t.drawImage(o,0,0,100,100)}}C.init(),C.clearEvent(),C.colorChangeEvent(),(new class{constructor(){this.tools=document.querySelector(".section-main-sidebar-tools-list")}showmessage(){this.tools.addEventListener("mouseover",e=>{let t=e.target,i=t.getAttribute("data-tooltip");if(i){let e=document.createElement("div");e.className="tooltip",e.innerHTML=i||tooltipchild,document.body.appendChild(e);let n=t.getBoundingClientRect(),o=n.left+(t.offsetWidth-e.offsetWidth)/2;o<0&&(o=0);let l=n.top-e.offsetHeight-5;l<0&&(l=n.top+t.offsetHeight+5),e.style.left=o+"px",e.style.top=l+"px",this.showingTooltip=e}}),this.tools.addEventListener("mouseout",e=>{this.showingTooltip&&(document.body.removeChild(this.showingTooltip),this.showingTooltip=null)})}}).showmessage(),function(){let e=localStorage.getItem("canvas"),t=localStorage.getItem("link");if(e&&"0"===t){let t=new Image;t.src=e,t.onload=function(){S.drawImage(t,0,0)}}else 0!==t?function(e){S.fillStyle="#ffffff",S.fillRect(0,0,512,512);let t=new Image;t.src=e,t.onload=function(){S.drawImage(t,256-t.width/2,256-t.height/2)}}(t):(S.fillStyle="#ffffff",S.fillRect(0,0,512,512));w()}(),_.addEventListener("click",e=>{document.querySelector(".section-main-frame-canvas.act").classList.remove("act");let t=I.children.length,i=`canvas_${+I.children[t-1].children[0].id.split("_")[1]+1}`,n=document.createElement("canvas"),o=document.createElement("div"),l=document.createElement("button"),a=document.createElement("button");l.className="button",l.innerText="X",a.className="copy",a.innerText="C",n.className="section-main-frame-canvas act",n.id=i,n.width=100,n.height=100,I.appendChild(o),o.appendChild(n),o.appendChild(a),o.appendChild(l)}),I.addEventListener("click",e=>{if("button"==e.target.classList[0]){e.target.parentNode.remove();let t=I.children.length;I.children[t-1].children[0].className="section-main-frame-canvas act"}else if("copy"==e.target.classList[0]){let t=document.createElement("canvas"),i=document.createElement("div"),o=document.createElement("button"),l=document.createElement("button"),a=e.target.previousElementSibling.id,s=`${a}copy_${function(e,t){let i=e-.5+Math.random()*(t-e+1);return Math.round(i)}(1,100)}`;o.className="button",o.innerText="X",l.className="copy",l.innerText="C",t.className="section-main-frame-canvas act",t.width=100,t.height=100,t.id=s,e.target,e.target.parentElement.previousElementSibling&&e.target.parentElement.nextElementSibling?I.insertBefore(i,e.target.parentElement.nextElementSibling):!e.target.parentElement.previousElementSibling&&e.target.parentElement.nextElementSibling?I.insertBefore(i,e.target.parentElement.nextElementSibling):!e.target.parentElement.previousElementSibling&&e.target.parentElement.nextElementSibling?I.insertBefore(i,e.target.parentElement.nextElementSibling):e.target.parentElement.nextElementSibling||I.appendChild(i),i.appendChild(t),i.appendChild(l),i.appendChild(o),document.querySelector(".section-main-frame-canvas.act").classList.remove("act");let c=I.children.length;I.children[c-1].children[0].className="section-main-frame-canvas act",function(e,t){let i=document.getElementById(`${e}`).getContext("2d"),o=localStorage.getItem(`${t}`),l=new Image;l.src=o,l.onload=function(){i.drawImage(l,0,0,100,100),n(e,o)}}(s,a)}}),E.forEach(e=>{e.addEventListener("click",t=>{let i=e.id;C.activeButton(i),document.querySelector(".section-main-switch__button.active").classList.remove("active"),t.target.classList.toggle("active")})}),b.forEach(e=>{e.addEventListener("click",t=>{document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active");let i=e.firstElementChild.id;C.activeTool(i),"section-main-sidebar-tools-list__item"===t.target.className?t.target.firstChild.classList.toggle("active"):t.target.classList.toggle("active")})}),document.addEventListener("keydown",e=>{66===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),d.classList.toggle("active"),C.activeTool("paint_bucket")):80===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),u.classList.toggle("active"),C.activeTool("pencil")):67===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),m.classList.toggle("active"),C.activeTool("choose_color")):79===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),h.classList.toggle("active"),C.activeTool("pencil2")):73===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),g.classList.toggle("active"),C.activeTool("pencil3")):76===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),f.classList.toggle("active"),C.activeTool("line")):69===e.keyCode?(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),v.classList.toggle("active"),C.activeTool("eraser")):88===e.keyCode&&(document.querySelector(".section-main-sidebar-tools-list__item-img.active").classList.remove("active"),p.children[0].classList.toggle("active"),S.fillStyle="#ffffff",S.fillRect(0,0,512,512),w())}),x.addEventListener("click",e=>{document.getElementById("wrapper-loading-page").style.display="none",document.getElementById("wrapper-main-page").style.display="block"}),i(1),i(2)}]);